<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API Tester - Personal Notes Manager</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        body {
            max-width: 1200px;
            margin: 0 auto;
        }
        .api-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px auto;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            max-width: 100%;
        }
        .api-section h3 {
            margin-top: 0;
            color: #333;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        .btn:hover {
            background: #45a049;
        }
        .btn-danger {
            background: #f44336;
        }
        .btn-danger:hover {
            background: #da190b;
        }
        .btn-info {
            background: #2196F3;
        }
        .btn-info:hover {
            background: #0b7dda;
        }
        .response-area {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status-200 { background: #4CAF50; color: white; }
        .status-201 { background: #8BC34A; color: white; }
        .status-400 { background: #FF9800; color: white; }
        .status-404 { background: #f44336; color: white; }
        .status-500 { background: #9E9E9E; color: white; }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .small-input {
            display: inline-block;
            width: auto;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <header>
        <h1>API Tester</h1>
        <p>Test all API endpoints with interactive UI</p>
        <nav>
            <a href="/">Home</a>
            <a href="/search?q=test">Search</a>
            <a href="/item/1">Item</a>
            <a href="/contact">Contact</a>
            <a href="/about">About</a>
            <a href="/api-test" style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 4px;">API Test</a>
        </nav>
    </header>

    <!-- CREATE NOTE -->
    <section class="api-section">
        <h3>üìù Create New Note (POST)</h3>
        <form id="createForm">
            <div class="form-group">
                <label>Title *</label>
                <input type="text" id="createTitle" required placeholder="Enter note title">
            </div>
            <div class="form-group">
                <label>Content *</label>
                <textarea id="createContent" required placeholder="Enter note content"></textarea>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="createCategory">
                    <option value="general">General</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="study">Study</option>
                </select>
            </div>
            <button type="submit" class="btn">Create Note</button>
        </form>
        <div class="response-area" id="createResponse">Response will appear here...</div>
    </section>

    <!-- GET ALL NOTES -->
    <section class="api-section">
        <h3>üìã Get All Notes (GET)</h3>
        <div class="grid-2">
            <div class="form-group">
                <label>Filter by Category</label>
                <select id="filterCategory">
                    <option value="">All Categories</option>
                    <option value="general">General</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="study">Study</option>
                </select>
            </div>
            <div class="form-group">
                <label>Search Text</label>
                <input type="text" id="searchText" placeholder="Search in title and content">
            </div>
            <div class="form-group">
                <label>Sort By</label>
                <select id="sortBy">
                    <option value='{"createdAt":-1}'>Date (Newest First)</option>
                    <option value='{"createdAt":1}'>Date (Oldest First)</option>
                    <option value='{"title":1}'>Title (A-Z)</option>
                    <option value='{"title":-1}'>Title (Z-A)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Show Fields</label>
                <input type="text" id="fields" placeholder="e.g., title,category">
            </div>
        </div>
        <button onclick="getAllNotes()" class="btn btn-info">Get All Notes</button>
        <button onclick="clearFilters()" class="btn">Clear Filters</button>
        <div class="response-area" id="getAllResponse">Response will appear here...</div>
    </section>

    <!-- GET BY ID -->
    <section class="api-section">
        <h3>üîç Get Note by ID (GET)</h3>
        <div class="form-group">
            <label>Note ID</label>
            <input type="text" id="getNoteId" placeholder="Enter MongoDB ObjectId" class="small-input">
            <button onclick="getNoteById()" class="btn btn-info">Get Note</button>
        </div>
        <div class="response-area" id="getByIdResponse">Response will appear here...</div>
    </section>

    <!-- UPDATE NOTE -->
    <section class="api-section">
        <h3>‚úèÔ∏è Update Note (PUT)</h3>
        <div class="form-group">
            <label>Note ID *</label>
            <input type="text" id="updateId" required placeholder="Enter MongoDB ObjectId">
        </div>
        <div class="form-group">
            <label>New Title *</label>
            <input type="text" id="updateTitle" required placeholder="Enter new title">
        </div>
        <div class="form-group">
            <label>New Content *</label>
            <textarea id="updateContent" required placeholder="Enter new content"></textarea>
        </div>
        <div class="form-group">
            <label>New Category</label>
            <select id="updateCategory">
                <option value="general">General</option>
                <option value="work">Work</option>
                <option value="personal">Personal</option>
                <option value="study">Study</option>
            </select>
        </div>
        <button onclick="updateNote()" class="btn">Update Note</button>
        <div class="response-area" id="updateResponse">Response will appear here...</div>
    </section>

    <!-- DELETE NOTE -->
    <section class="api-section">
        <h3>üóëÔ∏è Delete Note (DELETE)</h3>
        <div class="form-group">
            <label>Note ID</label>
            <input type="text" id="deleteId" placeholder="Enter MongoDB ObjectId" class="small-input">
            <button onclick="deleteNote()" class="btn btn-danger">Delete Note</button>
        </div>
        <div class="response-area" id="deleteResponse">Response will appear here...</div>
    </section>

    <footer>
        <p>&copy; 2026 Personal Notes Manager - API Testing Interface</p>
    </footer>

    <script>
        // Helper function to display response
        function displayResponse(elementId, status, data) {
            const element = document.getElementById(elementId);
            const statusClass = `status-${status}`;
            const statusBadge = `<span class="status-badge ${statusClass}">Status: ${status}</span>\n\n`;
            element.innerHTML = statusBadge + JSON.stringify(data, null, 2);
        }

        // CREATE NOTE
        document.getElementById('createForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                title: document.getElementById('createTitle').value,
                content: document.getElementById('createContent').value,
                category: document.getElementById('createCategory').value
            };

            try {
                const response = await fetch('/api/notes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                displayResponse('createResponse', response.status, result);
                
                if (response.status === 201) {
                    document.getElementById('createForm').reset();
                    // Auto-fill the ID in update and delete fields
                    document.getElementById('updateId').value = result._id;
                    document.getElementById('deleteId').value = result._id;
                    document.getElementById('getNoteId').value = result._id;
                }
            } catch (error) {
                displayResponse('createResponse', 500, { error: error.message });
            }
        });

        // GET ALL NOTES
        async function getAllNotes() {
            const category = document.getElementById('filterCategory').value;
            const search = document.getElementById('searchText').value;
            const sort = document.getElementById('sortBy').value;
            const fields = document.getElementById('fields').value;

            let url = '/api/notes?';
            if (category) url += `category=${category}&`;
            if (search) url += `search=${encodeURIComponent(search)}&`;
            if (sort) url += `sort=${encodeURIComponent(sort)}&`;
            if (fields) url += `fields=${fields}&`;

            try {
                const response = await fetch(url);
                const result = await response.json();
                displayResponse('getAllResponse', response.status, result);
            } catch (error) {
                displayResponse('getAllResponse', 500, { error: error.message });
            }
        }

        // GET NOTE BY ID
        async function getNoteById() {
            const id = document.getElementById('getNoteId').value.trim();
            if (!id) {
                alert('Please enter a note ID');
                return;
            }

            try {
                const response = await fetch(`/api/notes/${id}`);
                const result = await response.json();
                displayResponse('getByIdResponse', response.status, result);
                
                // Auto-fill update form if successful
                if (response.status === 200) {
                    document.getElementById('updateId').value = result._id;
                    document.getElementById('updateTitle').value = result.title;
                    document.getElementById('updateContent').value = result.content;
                    document.getElementById('updateCategory').value = result.category;
                }
            } catch (error) {
                displayResponse('getByIdResponse', 500, { error: error.message });
            }
        }

        // UPDATE NOTE
        async function updateNote() {
            const id = document.getElementById('updateId').value.trim();
            if (!id) {
                alert('Please enter a note ID');
                return;
            }

            const data = {
                title: document.getElementById('updateTitle').value,
                content: document.getElementById('updateContent').value,
                category: document.getElementById('updateCategory').value
            };

            try {
                const response = await fetch(`/api/notes/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                displayResponse('updateResponse', response.status, result);
            } catch (error) {
                displayResponse('updateResponse', 500, { error: error.message });
            }
        }

        // DELETE NOTE
        async function deleteNote() {
            const id = document.getElementById('deleteId').value.trim();
            if (!id) {
                alert('Please enter a note ID');
                return;
            }

            if (!confirm('Are you sure you want to delete this note?')) {
                return;
            }

            try {
                const response = await fetch(`/api/notes/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                displayResponse('deleteResponse', response.status, result);
                
                if (response.status === 200) {
                    document.getElementById('deleteId').value = '';
                }
            } catch (error) {
                displayResponse('deleteResponse', 500, { error: error.message });
            }
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('filterCategory').value = '';
            document.getElementById('searchText').value = '';
            document.getElementById('sortBy').value = '{"createdAt":-1}';
            document.getElementById('fields').value = '';
            getAllNotes();
        }

        // Load all notes on page load
        window.addEventListener('load', getAllNotes);
    </script>
</body>
</html>
